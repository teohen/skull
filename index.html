<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card Game</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    #game-container {
      width: 100%;
      height: 100vh;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .card {
      width: 33%;
      height: 30%;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      display: inline-block;
      margin: 3px;
      cursor: pointer;
      position: relative;
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s ease-in-out;
      border: solid;
    }

    .card button {
      display: block;
    }

    .card:hover {
      transform: scale(1.05);
    }

    .hand {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      text-align: center;
      height: 34%;
      display: flex;
      flex-direction: row;
    }

    .rose {
      background-color: rgba(0, 128, 0, 0.733);
    }

    .skull {
      background-color: rgba(243, 0, 0, 0.733);
    }

    .dead {
      background-color: grey;
      opacity: 50%;
    }

    .table {
      width: 100%;
      text-align: center;
      display: flex;
      height: 33%;
      background-color: #8B4513;
      /* Brown color for the table top */
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.3);
      /* Add a subtle shadow */
    }

    .hidden {
      background-color: rgb(100, 99, 99);
    }

    .graveyard {
      width: 50%;
      height: 150px;
      background-color: #333;
      margin-top: 20px;
      border-radius: 5px;
      margin-bottom: 10px;
      text-align: center;
      line-height: 5;
    }

    .graveyard h2 {
      color: grey;
    }

    .hide {
      visibility: hidden;
    }

    .utils {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 33%;
    }

    .footer {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      gap: 10px;
      padding: 2px;
    }
  </style>
</head>

<body>
  <div id="game-container">
    <div class="table">
      <h2>MESA</h2>
    </div>
    <div class="utils">
      <div class="graveyard" id="graveyard">
        <h2>&#128465;</h2>
      </div>
      <div class="footer">
        <button id="hideall" type="button">virar cartas</button>
        <button id="restart" type="button">recolher da mesa</button>
        <button id="hidehand" type="button">esconder mão</button>
        <button id="showhand" type="button">mostrar mão</button>
      </div>
    </div>
    <div class="hand"></div>
  </div>

  <script>
    function createNode(data) {
      const card = document.createElement("div");
      card.classList.add("card", "draggable", data.type)
      card.setAttribute("id", data.id)
      card.draggable = true
      if (data.type == 'skull') {
        card.innerHTML = `<h1 id=${data.id}>&#9940;</h1>`
      } else {
        card.innerHTML = `<h1 id=${data.id}>&#9989;</h1>`
      }

      return card
    }

    function getRandomNumber() {
      const randomNumber = Math.random();
      const result = Math.floor(randomNumber * 4) + 1;
      return result;
    }

    function defineSkull() {
      const number = getRandomNumber()

      gcards[number - 1] = {
        id: number,
        type: 'skull',
        html: createNode({ id: number, type: 'skull' }),
        place: 'hand',
        active: true,
        visible: true,
        pos: 0
      }
    }

    function cardInvert(e) {
      for (let card of gcards) {
        if (card.active) {
          if (card.id == e.target.id) {
            card.visible = !card.visible
          }
        }
      }
      renderGame()
    }

    const gcards = [
      {
        id: 1,
        type: 'rose',
        html: createNode({ id: 1, type: 'rose' }),
        place: 'hand',
        active: true,
        visible: true,
        pos: 0
      },
      {
        id: 2,
        type: 'rose',
        html: createNode({ id: 2, type: 'rose' }),
        place: 'hand',
        active: true,
        visible: true,
        pos: 0
      },
      {
        id: 3,
        type: 'rose',
        html: createNode({ id: 3, type: 'rose' }),
        place: 'hand',
        active: true,
        visible: true,
        pos: 0
      },
      {
        id: 4,
        type: 'rose',
        html: createNode({ id: 4, type: 'rose' }),
        place: 'hand',
        active: true,
        visible: true,
        pos: 0
      }
    ]

    const ghand = document.querySelector('.hand');
    const gtable = document.querySelector('.table');

    function renderGame() {

      ghand.innerHTML = ""
      gtable.innerHTML = ""


      for (let card of gcards) {

        card.html.style.order = card.pos


        if (!card.visible) {
          card.html.classList.add("hidden")
          card.html.children[0].classList.add("hide")
        } else {
          card.html.classList.remove("hidden")
          card.html.children[0].classList.remove("hide")
        }
        if (!card.active) {
          card.html.classList.remove("hidden")
          card.html.classList.add("dead")
          card.html.draggable = false
          card.html.children[0].classList.add("hide")
        }

        if (card.place == 'hand') {
          ghand.appendChild(card.html)
        } else {
          gtable.appendChild(card.html)
        }
      }
    }

    function mechanics() {
      // Add dragstart and dragend event listeners to each card
      ghand.addEventListener('dragstart', (e) => {
        const target = e.target;
        selected = e.target.id

        if (target.classList.contains('card')) {
          e.dataTransfer.setData('text/plain', target.textContent);
        }
      });

      // Add dragover and drop event listeners to the table
      gtable.addEventListener('dragover', (e) => {
        e.preventDefault(); // Allow drop
      });

      gtable.addEventListener('drop', (e) => {
        e.preventDefault();
        for (let card of gcards) {
          if (card.id == selected) {
            tablePos += 1
            card.pos = tablePos
            card.place = 'table'
          }
        }
        renderGame()
      })

      const cardsList = document.getElementsByClassName('card');


      for (let card of cardsList) {
        card.addEventListener('click', cardInvert)
      }

      const hideAll = document.getElementById("hideall")
      hideAll.addEventListener('click', () => {
        for (card of gcards) {
          if (card.active) {
            card.visible = false
          }
        }

        renderGame()
      })

      const restart = document.getElementById("restart")
      restart.addEventListener('click', () => {
        for (card of gcards) {
          card.place = 'hand'
        }
        renderGame()
      })

      const graveyard = document.getElementById("graveyard")

      graveyard.addEventListener('dragover', (e) => {
        e.preventDefault()
      })

      graveyard.addEventListener('drop', () => {
        for (card of gcards) {
          if (card.id == selected) {
            card.active = false
          }
        }

        renderGame()
      })

      document.getElementById("hidehand")
      hidehand.addEventListener('click', () => {
        ghand.classList.add("hide")
      })

      document.getElementById("showhand")
      showhand.addEventListener('click', () => {
        ghand.classList.remove("hide")
      })
    }

    let selected = 0

    let tablePos = 0

    defineSkull()

    renderGame()

    mechanics()


  </script>
</body>

</html>